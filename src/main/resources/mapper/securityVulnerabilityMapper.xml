<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.openeg.openegscts.admin.repository.ISecurityVulnerabilityMapper">

    <select id="getAllSecurityCategoryInfo" resultType="com.openeg.openegscts.admin.entity.SecurityCategory">
        select scategory_id as scategoryId,
               scategory_name as scategoryName,
               sc_reg_date as scRegDate
        from security_category_tb
        order by sc_reg_date asc
    </select>

    <insert id="insertSV" useGeneratedKeys="true" keyProperty="secId" parameterType="com.openeg.openegscts.student.entity.SecurityCode">
        insert into security_tb(sec_id, scategory_id, sec_name, sec_pdf, sec_video, sec_reg_date)
               values(#{secId}, #{scategoryId}, #{secName}, #{secPdf}, #{secVideo}, DATE_FORMAT(SYSDATE(), '%Y/%m/%d %H:%i:%s'))
    </insert>

    <select id="confirmSecName" resultType="int" parameterType="string">
        select count(*) as count
        from security_tb
        where sec_name=#{secName}
    </select>

    <select id="getAllSV" resultType="com.openeg.openegscts.student.entity.SecurityCode">
        select se.sec_id as secId,
               se.sec_name as secName,
               se.sec_pdf as secPdf,
               se.sec_video as secVideo,
               se.sec_reg_date as secRegDate,
               sc.scategory_id as scategoryId,
               sc.scategory_name as scategoryName
        from security_tb se, security_category_tb sc
        where se.scategory_id=sc.scategory_id
        order by se.sec_reg_date asc
    </select>

    <select id="getSV" resultType="com.openeg.openegscts.student.entity.SecurityCode" parameterType="long">
        select sec_pdf as secPdf, sec_video as secVideo
        from security_tb
        where sec_id=#{secId}
    </select>

    <delete id="deleteSV" parameterType="long">
        delete from security_tb where sec_id=#{secId}
    </delete>

    <insert id="insertSC" useGeneratedKeys="true" keyProperty="scategoryId" parameterType="com.openeg.openegscts.admin.entity.SecurityCategory">
        insert into security_category_tb(scategory_id, scategory_name, sc_reg_date)
               values(#{scategoryId}, #{scategoryName}, DATE_FORMAT(SYSDATE(), '%Y/%m/%d %H:%i:%s'))
    </insert>

    <update id="updateSCategory" parameterType="com.openeg.openegscts.admin.entity.SecurityCategory">
        update security_tb set scategory_name=#{scategoryName}
        where scategory_id=#{scategoryId}
    </update>

    <delete id="deleteSCategory" parameterType="long">
        delete from security_category_tb where scategory_id=#{scategoryId}
    </delete>

    <update id="updateSV" parameterType="com.openeg.openegscts.student.entity.SecurityCode">
        update security_tb set    scategory_id=#{scategoryId},
                                  sec_name=#{secName},
                                  sec_pdf=#{secPdf},
                                  sec_video=#{secVideo}
        where sec_id=#{secId}
    </update>

</mapper>